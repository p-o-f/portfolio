---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const sortedProjects = projects.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Split into current and past projects
const currentProjects = sortedProjects.filter(p => p.data.current);
const pastProjects = sortedProjects.filter(p => !p.data.current);
---

<BaseLayout title="Projects">
  <div class="container page">
    
    <!-- Currently Working On -->
    <section class="projects-section">
      <header class="section-header">
        <h1>Currently Working On</h1>
        <p class="text-muted">Projects and ideas I'm actively focusing on.</p>
      </header>
      
      {currentProjects.length > 0 ? (
        <div class="project-grid">
          {currentProjects.map(project => (
            <a href={`/projects/${project.id}`} class="card project-card">
              <h2>{project.data.title}</h2>
              <p>{project.data.description}</p>
              {project.data.tags && (
                <div class="tags">
                  {project.data.tags.map(tag => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
              {project.data.link && (
                <div class="project-links">
                  <span class="project-link">View Project →</span>
                </div>
              )}
            </a>
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <p class="text-muted">No active projects at the moment.</p>
        </div>
      )}
    </section>
    
    <!-- Past Projects -->
    <section class="projects-section">
      <header class="section-header">
        <h2>Past Projects</h2>
        <p class="text-muted">Completed work and projects I maintain on the side.</p>
      </header>
      
      {pastProjects.length > 0 ? (
        <div class="project-grid">
          {pastProjects.map(project => (
            <a href={`/projects/${project.id}`} class="card project-card">
              <h2>{project.data.title}</h2>
              <p>{project.data.description}</p>
              {project.data.tags && (
                <div class="tags">
                  {project.data.tags.map(tag => (
                    <span class="tag">{tag}</span>
                  ))}
                </div>
              )}
              {project.data.link && (
                <div class="project-links">
                  <span class="project-link">View Project →</span>
                </div>
              )}
            </a>
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <p class="text-muted">No past projects yet.</p>
        </div>
      )}
    </section>
    
  </div>
</BaseLayout>

<style>
  .projects-section {
    margin-bottom: var(--space-3xl);
  }
  
  .section-header {
    margin-bottom: var(--space-xl);
  }
  
  .section-header h1 {
    margin-bottom: var(--space-sm);
  }
  
  .section-header h2 {
    margin-bottom: var(--space-sm);
  }
  
  .project-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-lg);
  }
  
  .project-card h2 {
    font-size: 1.25rem;
    margin-bottom: var(--space-sm);
  }
  
  .project-card p {
    margin-bottom: var(--space-md);
    color: var(--color-text-muted);
  }
  
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
  }
  
  .project-links {
    display: flex;
    gap: var(--space-md);
    font-size: 0.875rem;
    color: var(--color-accent);
  }
  
  .empty-state {
    padding: var(--space-xl);
    background: var(--color-bg-secondary);
    border: 1px dashed var(--color-border);
    border-radius: 12px;
    text-align: center;
  }
</style>
